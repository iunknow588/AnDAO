# AnDaoWallet H5 开发环境配置指南

## 文档信息

- **项目名称**: AnDaoWallet HTML5 版本
- **文档版本**: 1.0
- **创建日期**: 2024年
- **文档状态**: 正式版

## 目录

1. [环境变量配置](#1-环境变量配置)
2. [代码质量工具](#2-代码质量工具)
3. [PWA 功能验证](#3-pwa-功能验证)
4. [监控服务配置](#4-监控服务配置)

---

## 1. 环境变量配置

### 1.1 创建环境变量文件

复制示例文件并创建本地环境变量文件：

```bash
# 开发环境
cp .env.example .env.local

# 生产环境
cp .env.example .env.production
```

### 1.2 配置环境变量

编辑 `.env.local` 文件，根据实际情况配置：

```bash
# Mantle 链配置
VITE_MANTLE_RPC_URL=https://rpc.mantle.xyz
VITE_MANTLE_BUNDLER_URL=https://bundler.example.com
VITE_MANTLE_KERNEL_FACTORY_ADDRESS=0x...
VITE_MANTLE_ENTRYPOINT_ADDRESS=0x...

# 监控配置（可选）
VITE_ENABLE_SENTRY=false
VITE_SENTRY_DSN=
```

### 1.3 使用环境变量

在代码中使用环境变量：

```typescript
// 通过 import.meta.env 访问
const rpcUrl = import.meta.env.VITE_MANTLE_RPC_URL;
```

**注意**: 只有以 `VITE_` 开头的环境变量才会被 Vite 暴露给客户端代码。

---

## 2. 代码质量工具

### 2.1 ESLint

运行 ESLint 检查：

```bash
# 检查代码
npm run lint

# 自动修复
npm run lint-fix
```

### 2.2 Prettier

Prettier 配置已保存在 `.prettierrc` 文件中。

### 2.3 Husky Git Hooks

#### 2.3.1 初始化 Husky

首次使用需要初始化 Husky：

```bash
npm run prepare
```

这会在 `.husky` 目录下创建 Git hooks。

#### 2.3.2 配置 pre-commit Hook

创建 `.husky/pre-commit` 文件：

```bash
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

npx lint-staged
```

### 2.4 lint-staged

`lint-staged` 配置已保存在 `.lintstagedrc.js` 文件中。

在提交代码时，会自动运行：
- ESLint 检查和修复
- Prettier 格式化

---

## 3. PWA 功能验证

### 3.1 运行验证脚本

```bash
npm run pwa:verify
```

验证脚本会检查：
- `manifest.json` 文件是否存在
- `manifest.json` 配置是否完整
- Service Worker 配置是否正确
- PWA 图标文件是否存在

### 3.2 验证结果

验证脚本会输出详细的验证报告，包括：
- ✅ 通过的检查项
- ❌ 失败的检查项
- ⚠️ 警告项

### 3.3 修复问题

根据验证报告修复问题：
- 创建缺失的图标文件
- 完善 `manifest.json` 配置
- 检查 `vite.config.ts` 中的 PWA 配置

---

## 4. 监控服务配置

### 4.1 Sentry 集成（可选）

#### 4.1.1 安装 Sentry

```bash
npm install --save @sentry/react
```

#### 4.1.2 配置环境变量

在 `.env.local` 中配置：

```bash
VITE_ENABLE_SENTRY=true
VITE_SENTRY_DSN=https://xxx@sentry.io/xxx
```

#### 4.1.3 使用监控服务

监控服务会在应用启动时自动初始化（`main.tsx`）。

在代码中使用：

```typescript
import { monitoringService } from '@/services/MonitoringService';

// 捕获异常
monitoringService.captureException(error, { context: 'additional info' });

// 捕获消息
monitoringService.captureMessage('Something happened', 'info');

// 设置用户信息
monitoringService.setUser({ id: 'user123', email: 'user@example.com' });
```

### 4.2 错误边界集成

`ErrorBoundary` 组件已自动集成监控服务，所有被捕获的错误都会自动发送到 Sentry（如果已启用）。

---

## 5. 开发服务器

### 5.1 启动开发服务器

```bash
npm run dev
```

开发服务器会在 `http://localhost:3000` 启动。

### 5.2 热模块替换（HMR）

Vite 默认支持 HMR，修改代码后会自动更新。

### 5.3 代理配置

在 `vite.config.ts` 中已配置代理：

```typescript
server: {
  proxy: {
    '/api': {
      target: 'http://localhost:8080',
      changeOrigin: true
    }
  }
}
```

---

## 6. 构建和部署

### 6.1 构建生产版本

```bash
npm run build
```

构建输出在 `dist/` 目录。

### 6.2 预览构建结果

```bash
npm run preview
```

---

## 7. 测试

### 7.1 运行测试

```bash
# 运行所有测试
npm test

# 监听模式
npm run test:watch

# 测试覆盖率
npm run test:coverage
```

### 7.2 测试网验证

```bash
npm run testnet:verify
```

---

## 8. 常见问题

### 8.1 环境变量不生效

- 确保环境变量以 `VITE_` 开头
- 重启开发服务器
- 检查 `.env.local` 文件是否正确

### 8.2 Husky hooks 不工作

- 运行 `npm run prepare` 初始化 Husky
- 确保 `.husky` 目录存在
- 检查 Git hooks 权限

### 8.3 PWA 验证失败

- 检查 `manifest.json` 文件是否存在
- 检查图标文件是否存在
- 检查 `vite.config.ts` 中的 PWA 配置

### 8.4 Sentry 不工作

- 确保安装了 `@sentry/react`
- 检查环境变量 `VITE_ENABLE_SENTRY` 和 `VITE_SENTRY_DSN`
- 查看浏览器控制台是否有错误

---

## 更新日志

- **v1.0** (2024): 初始版本，创建开发环境配置指南

